<div id="map"></div>

<script>
  import { Feature, Map, View } from "ol";
  import { Point } from "ol/geom";
  import TileLayer from "ol/layer/Tile";
  import VectorLayer from "ol/layer/Vector";
  import { OSM, Vector } from "ol/source";

  import "ol/ol.css";

  const map = new Map({
    target: "map",
    layers: [
      new TileLayer({
        source: new OSM(),
      }),
    ],
    view: new View({
      center: [0, 0],
      zoom: 2,
    }),
  });

  const response = await fetch("/exchanges/exchanges.json");
  const exchanges = (await response.json()) as {
    geometry: { x: number; y: number };
  }[];

  // it's actually GDA94, but eh
  const crsWgs84 = "EPSG:4326";
  const crsOsm = "EPSG:3857";
  const layer = new VectorLayer({
    source: new Vector({
      features: exchanges.map(
        (exchange) =>
          new Feature(
            new Point([exchange.geometry.x, exchange.geometry.y]).transform(
              crsWgs84,
              crsOsm
            )
          )
      ),
    }),
  });

  map.addLayer(layer);
</script>

<style>
  html,
  body,
  #map {
    width: 100%;
    height: 100%;
    margin: 0;
  }
</style>
